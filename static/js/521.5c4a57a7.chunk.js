"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[521],{2521:function(e,s,a){a.r(s),a.d(s,{default:function(){return C}});var t=a(9439),n=a(2791),r=a(8081),i=a(4139),o=a(7062),c={messages:"Messages_messages__6bLcq"},_=a(7689),d={dialog:"DialogBody_dialog__Fr21p",no_messages:"DialogBody_no_messages__Yuu+K",dialog_messages:"DialogBody_dialog_messages__nGOGr"},u={message:"MessagesBody_message__E2Uco",myMessage:"MessagesBody_myMessage__5EiAc",message__wrapper:"MessagesBody_message__wrapper__kwo4e",message__body:"MessagesBody_message__body__z3bbE",message__time:"MessagesBody_message__time__+G2JH",message__content:"MessagesBody_message__content__My63t"},l=a(184);function g(e){var s=e.item,a=e.authUserData,t=new Date(s.addedAt),n=t.getHours()+2;n=n<10?"0".concat(n):"".concat(n);var r=t.getMinutes();r=r<10?"0".concat(r):"".concat(r);var i="".concat(n,":").concat(r);return(0,l.jsx)("div",{className:a.id===s.senderId?"".concat(u.message," ").concat(u.myMessage):"".concat(u.message),children:(0,l.jsx)("div",{className:u.message__wrapper,children:(0,l.jsxs)("div",{className:u.message__content,children:[(0,l.jsx)("span",{className:u.message__body,children:s.body}),(0,l.jsx)("span",{className:u.message__time,children:i})]})})})}function m(e){var s=e.dialogData,a=e.authUserData,t=(0,n.useRef)(null);return(0,n.useEffect)((function(){t.current&&t.current.scrollIntoView()}),[]),(0,n.useEffect)((function(){t.current&&t.current.scrollIntoView({behavior:"smooth"})}),[s]),(0,l.jsx)("div",{className:d.dialog,children:(0,l.jsxs)("div",{className:d.dialog_messages,children:[s.length?s.map((function(e){return(0,l.jsx)(g,{item:e,authUserData:a},e.id)})):(0,l.jsxs)("div",{className:d.no_messages,children:[(0,l.jsx)("div",{children:"No messages yet"}),(0,l.jsx)("div",{children:"Send first one"})]}),(0,l.jsx)("div",{ref:t})]})})}var h=a(9335),x={header_box:"DialogHeader_header_box__oeomP",header:"DialogHeader_header__Yb7-O",photo_box:"DialogHeader_photo_box__0v1-J",photo:"DialogHeader_photo__CdVFt",userInfo_box:"DialogHeader_userInfo_box__Q4CFy",userInfo_name:"DialogHeader_userInfo_name__mE7mL",userInfo_date:"DialogHeader_userInfo_date__J46YO"},f=function(e){var s=new Date,a=new Date(e),t=a.getHours()+2;t=t<10?"0".concat(t):"".concat(t);var n=a.getMinutes();n=n<10?"0".concat(n):"".concat(n);var r="".concat(t,":").concat(n);return s.getDay()===a.getDay()&&s.getDate()===a.getDate()||(r="".concat(["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][a.getDay()]," ").concat(r)),r};function v(e){var s=e.usersData,a=(0,_.UO)().dialogId,t=s.filter((function(e){return e.id===+a?e.id:null}));return(0,l.jsx)("div",{children:t.map((function(e){return(0,l.jsx)(D,{user:e},e.id)}))})}function D(e){var s=e.user,a=f(s.lastUserActivityDate);return(0,l.jsx)("div",{className:x.header_box,children:(0,l.jsxs)("div",{className:x.header,children:[(0,l.jsx)("div",{className:x.photo_box,children:(0,l.jsx)("img",{className:x.photo,src:s.photos.small||h,alt:""})}),(0,l.jsxs)("div",{className:x.userInfo_box,children:[(0,l.jsx)("div",{className:x.userInfo_name,children:s.userName}),(0,l.jsx)("div",{className:x.userInfo_date,children:a})]})]})})}var j=a(4165),p=a(5861),b=a(2506),y={form_box:"DialogSendMessage_form_box__eMZAu",form:"DialogSendMessage_form__NDOWU",input:"DialogSendMessage_input__uYe6Z",submit:"DialogSendMessage_submit__UD4IR"};function N(e){var s=e.dialogData,a=e.setDialogData,t=(0,_.UO)().dialogId,n=function(){var e=(0,p.Z)((0,j.Z)().mark((function e(n,i){var o,c,_,d;return(0,j.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=i.setSubmitting,c=i.resetForm,o(!0),e.next=4,r.b.sendMessage(+t,n.messageText.trim());case 4:if(0!==e.sent.resultCode){e.next=12;break}return _=structuredClone(s),e.next=9,r.b.getLastSendedMessage(+t);case 9:d=e.sent,_.push(d.items[0]),a(_);case 12:c(),o(!1);case 14:case"end":return e.stop()}}),e)})));return function(s,a){return e.apply(this,arguments)}}();return(0,l.jsx)("div",{className:y.form_box,children:(0,l.jsx)(b.J9,{initialValues:{messageText:""},onSubmit:n,children:function(e){var s=e.isSubmitting;return(0,l.jsxs)(b.l0,{className:y.form,children:[(0,l.jsx)(b.gN,{type:"textarea",id:"messageText",name:"messageText",placeholder:"Type message text",className:y.input}),(0,l.jsx)("button",{disabled:s,className:y.submit,type:"submit",children:(0,l.jsx)("i",{className:"fa-regular fa-paper-plane"})})]})}})})}var M={active_dialog:"MessagesActiveDialog_active_dialog__vGESy"};function U(e){var s=e.usersData,a=e.authUserData,i=(0,_.UO)().dialogId,c=(0,n.useState)([]),d=(0,t.Z)(c,2),u=d[0],g=d[1],h=(0,n.useState)(),x=(0,t.Z)(h,2),f=x[0],D=x[1];return(0,n.useEffect)((function(){i&&(D(!0),r.b.getMessages(i).then((function(e){g(e.items),D(!1)})))}),[i]),(0,l.jsx)(l.Fragment,{children:f?(0,l.jsx)(o.Z,{}):(0,l.jsx)("div",{children:i&&(0,l.jsxs)("div",{className:M.active_dialog,children:[(0,l.jsx)(v,{usersData:s}),(0,l.jsx)(m,{dialogData:u,authUserData:a}),(0,l.jsx)(N,{dialogData:u,setDialogData:g})]})})})}var w={dialogs:"MessagesDialogs_dialogs__Uo-dZ"},S=a(1087),I={message:"User_message__dMCS2",user:"User_user__UM5Ov",activeUser:"User_activeUser__TULfc",user_lastMessage:"User_user_lastMessage__uxcu+",photo:"User_photo__PBYwG",image:"User_image__bnL-L",user_name:"User_user_name__Z+70k",message__info:"User_message__info__f5OaX",message__time:"User_message__time__tXURZ",new__message:"User_new__message__tFmXs"},Z=function(e){var s=new Date,a=new Date(e),t=a.getHours()+2;t=t<10?"0".concat(t):"".concat(t);var n=a.getMinutes();n=n<10?"0".concat(n):"".concat(n);var r="".concat(t,":").concat(n);return s.getDay()===a.getDay()&&s.getDate()===a.getDate()||(r="".concat(["Sun","Mon","Tues","Wed","Thurs","Fri","Sat"][a.getDay()])),r};var H=function(e){var s=e.item,a=(0,n.useState)(""),i=(0,t.Z)(a,2),o=i[0],c=i[1];return(0,n.useEffect)((function(){s.id&&r.b.getLastSendedMessage(s.id).then((function(e){e.totalCount>0&&c(e.items[0].body)}))}),[s.id]),(0,l.jsx)("div",{className:I.message,children:(0,l.jsxs)(S.OL,{to:"/messages/".concat(s.id),className:function(e){return e.isActive?"".concat(I.user," ").concat(I.activeUser):I.user},children:[(0,l.jsx)("div",{className:I.photo,children:(0,l.jsx)("img",{src:s.photos.small||h,className:I.image,alt:""})}),(0,l.jsxs)("div",{className:I.user_info,children:[(0,l.jsx)("div",{className:I.user_name,children:s.userName}),(0,l.jsx)("div",{className:I.user_lastMessage,children:o})]}),(0,l.jsxs)("div",{className:I.message__info,children:[(0,l.jsx)("div",{className:I.message__time,children:Z(s.lastDialogActivityDate)}),s.hasNewMessages&&(0,l.jsx)("div",{className:I.new__message,children:s.newMessagesCount})]})]})})};var B=function(e){var s=e.usersData;return(0,l.jsx)("div",{className:w.dialogs,children:s&&s.map((function(e){return(0,l.jsx)(H,{item:e},e.id)}))})};var C=function(){var e=(0,n.useContext)(i.Y).authUserData,s=(0,n.useState)(!1),a=(0,t.Z)(s,2),_=a[0],d=a[1],u=(0,n.useState)([]),g=(0,t.Z)(u,2),m=g[0],h=g[1];return(0,n.useEffect)((function(){d(!0),r.b.getDialogs().then((function(e){h(e),d(!1)}))}),[]),(0,l.jsx)(l.Fragment,{children:_?(0,l.jsx)(o.Z,{}):(0,l.jsxs)("div",{className:c.messages,children:[(0,l.jsx)(B,{usersData:m}),(0,l.jsx)(U,{usersData:m,authUserData:e})]})})}},9335:function(e,s,a){e.exports=a.p+"static/media/userImg.786cd0bf23ec91e54b7a.png"}}]);
//# sourceMappingURL=521.5c4a57a7.chunk.js.map