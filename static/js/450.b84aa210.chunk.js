"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[450],{3450:function(e,s,n){n.r(s),n.d(s,{default:function(){return l}});var t=n(3433),a=n(9439),r=n(2506),c=n(2791),i=n(9335),o={chat:"Chat_chat__DXAIn",messages:"Chat_messages__BQJjj",image:"Chat_image__OIphS",messageItem:"Chat_messageItem__SzQ4z",message_body:"Chat_message_body__jb4nF",userName:"Chat_userName__mXuOO",form:"Chat_form__Lp8+b",input:"Chat_input__GVTbM",submit:"Chat_submit__V2FDL"},u=n(184),m=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=(0,c.useState)(e),n=(0,a.Z)(s,2),t=n[0],r=n[1],i=(0,c.useCallback)((function(){return r((function(e){return!e}))}),[]);return[t,i]};var l=function(){var e=(0,c.useState)([]),s=(0,a.Z)(e,2),n=s[0],r=s[1],i=(0,c.useState)(null),l=(0,a.Z)(i,2),h=l[0],v=l[1],f=(0,c.useState)("pending"),_=(0,a.Z)(f,2),x=_[0],b=_[1],p=m(),j=(0,a.Z)(p,2),C=j[0],N=j[1];return(0,c.useEffect)((function(){var e,s=function(){console.log("close"),b("pending"),r([])},n=function(e){console.log("connected"),b("ready")},a=function(e){console.log("messages");var s=JSON.parse(e.data);r((function(e){return[].concat((0,t.Z)(e),(0,t.Z)(s))}))},c=function(e){console.log("error")},i="addEventListener",o="removeEventListener",u=function(e,t){switch(t){case i:e.addEventListener("open",n),e.addEventListener("message",a),e.addEventListener("close",s),e.addEventListener("error",c);break;case o:e.removeEventListener("open",n),e.removeEventListener("message",a),e.removeEventListener("close",s),e.removeEventListener("error",c)}};return h&&(u(h,o),h.close()),e=new WebSocket("wss://social-network.samuraijs.com/handlers/ChatHandler.ashx"),u(e,i),v(e),function(){e.close()}}),[C]),(0,u.jsxs)("div",{className:o.chat,children:[(0,u.jsx)(d,{wsChannel:h,messages:n,setIsReconnect:N}),(0,u.jsx)(g,{wsChannel:h,status:x})]})};function d(e){var s=e.wsChannel,n=e.messages,t=e.setIsReconnect,a=(0,c.useRef)(null);return(0,c.useEffect)((function(){a.current&&a.current.scrollIntoView({behavior:"smooth",block:"end"})}),[n]),(0,u.jsxs)("div",{className:o.messages,children:[s?n.length?n.map((function(e,s){return(0,u.jsx)(h,{item:e},s)})):(0,u.jsx)("div",{children:"No messages"}):(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{children:"Connection abort, click button to try reconnect"}),(0,u.jsx)("button",{onClick:function(){return t()},type:"submit",children:"Reconnect"})]}),(0,u.jsx)("div",{ref:a})]})}function h(e){var s=e.item;return(0,u.jsxs)("div",{className:o.messageItem,children:[(0,u.jsx)("img",{src:s.photo||i,className:o.image,alt:""}),(0,u.jsxs)("div",{className:o.message_body,children:[(0,u.jsx)("div",{className:o.userName,children:s.userName}),(0,u.jsx)("div",{className:o.message,children:s.message})]})]})}function g(e){var s=e.wsChannel,n=e.status;return(0,u.jsx)("div",{className:o.form_box,children:(0,u.jsx)(r.J9,{initialValues:{messageText:""},onSubmit:function(e,n){var t=n.setSubmitting,a=n.resetForm;e.messageText&&(s.send(e.messageText),t(!1),a())},children:function(e){e.isSubmitting;return(0,u.jsxs)(r.l0,{className:o.form,children:[(0,u.jsx)(r.gN,{type:"textarea",id:"messageText",name:"messageText",placeholder:"Type message text",className:o.input}),(0,u.jsx)("button",{disabled:"ready"!==n,className:o.submit,type:"submit",children:"Send"})]})}})})}},9335:function(e,s,n){e.exports=n.p+"static/media/userImg.786cd0bf23ec91e54b7a.png"}}]);
//# sourceMappingURL=450.b84aa210.chunk.js.map